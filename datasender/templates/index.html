{% extends 'base.html' %}

{% block title %}Weather Data{% endblock %}

{% block content %}
<div class="hero-full-container">
    <div class="background-image"></div>
    <div class="text-content">
        <div class="weather-container">
            <h2>Weather Data</h2>
        </div>
        
        <form method="post" class="data-form" id="select-form">
            {% csrf_token %}
            <div class="form-group">
                <label for="year-select">Select Year:</label>
                <select id="year-select" name="year" required>
                    {% for year in years %}
                        <option value="{{ year }}" {% if year == selected_year %}selected{% endif %}>{{ year }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="month-select">Select Month:</label>
                <select id="month-select" name="month" required>
                    <option value="1" {% if selected_month == '1' %}selected{% endif %}>January</option>
                    <option value="2" {% if selected_month == '2' %}selected{% endif %}>February</option>
                    <option value="3" {% if selected_month == '3' %}selected{% endif %}>March</option>
                    <option value="4" {% if selected_month == '4' %}selected{% endif %}>April</option>
                    <option value="5" {% if selected_month == '5' %}selected{% endif %}>May</option>
                    <option value="6" {% if selected_month == '6' %}selected{% endif %}>June</option>
                    <option value="7" {% if selected_month == '7' %}selected{% endif %}>July</option>
                    <option value="8" {% if selected_month == '8' %}selected{% endif %}>August</option>
                    <option value="9" {% if selected_month == '9' %}selected{% endif %}>September</option>
                    <option value="10" {% if selected_month == '10' %}selected{% endif %}>October</option>
                    <option value="11" {% if selected_month == '11' %}selected{% endif %}>November</option>
                    <option value="12" {% if selected_month == '12' %}selected{% endif %}>December</option>
                </select>
            </div>

            <div class="form-group">
                <label for="metric-select">Select Weather Metric:</label>
                <select id="metric-select" name="metric" required>
                    {% for metric in metrics %}
                        <option value="{{ metric }}" {% if metric == selected_metric %}selected{% endif %}>{{ metric }}</option>
                    {% endfor %}
                </select>
            </div>

            <button type="submit" class="btn">Retrieve Data</button>
        </form>

        {% if dynamic_data %}
            <h2>Weather Data for {{ selected_month|date:"F" }} {{ selected_year }}</h2>
            <table class="weather-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Value</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for metric, value in dynamic_data.items %}
                        <tr>
                            <td>{{ metric }}</td>
                            <td>{{ value }}</td>
                            <td>
                                <button class="btn-update" data-metric="{{ metric }}">Update</button>
                                <button class="btn-delete" data-metric="{{ metric }}">Delete</button>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>

            <h3>Add New Data</h3>
            <form method="post" id="add-form">
                {% csrf_token %}
                <input type="hidden" name="action" value="add">
                <input type="hidden" name="year" value="{{ selected_year }}">
                <input type="hidden" name="month" value="{{ selected_month }}">
                
                <label for="new_metric">New Metric:</label>
                <input type="text" id="new_metric" name="new_metric" placeholder="New Metric" required>
                
                <label for="new_value">New Value:</label>
                <input type="text" id="new_value" name="new_value" placeholder="New Value" required>
                
                <button type="submit" class="btn">Add Data</button>
            </form>
            
            <div id="update-form" style="display: none;">
                <h3>Update Data</h3>
                <form method="post" id="update-data-form">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="update">
                    <input type="hidden" name="year" value="{{ selected_year }}">
                    <input type="hidden" name="month" value="{{ selected_month }}">
                    <input type="hidden" name="old_metric" id="update-metric-old-name">
                    
                    <label for="update-metric-new-name">New Metric Name:</label>
                    <input type="text" id="update-metric-new-name" name="new_metric" required placeholder="New Metric Name">
                    
                    <label for="update-metric-value">New Value:</label>
                    <input type="text" id="update-metric-value" name="updated_value" required placeholder="New Value">
                    
                    <button type="submit" class="btn">Update Data</button>
                </form>
            </div>
            
            {% elif selected_year %}
                <p>No data available for this selection.</p>
            {% endif %}
            
    </div>
</div>

{% endblock %}